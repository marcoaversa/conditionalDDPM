apiVersion: v1
kind: Template # top level object is a Template 
metadata:
  # name/description etc for the template itself
  name: template-diffusion
  annotations:
    description: "Template diffusion"
    tags: "template"
# object(s) within the template, here just a single Job
objects:
- apiVersion: batch/v1
  kind: Job
  metadata:
    name: ${JOBNAME}
  spec:
    backoffLimit: 6
    template:
      metadata:
        name: ${JOBNAME}
      spec:
        restartPolicy: Never
        nodeSelector:
          node-role.ida/${GPUTYPE}: "true"
        containers:
          - name: ${CONTAINERNAME}
            image: ${IMAGE}
            resources:
              requests:
                cpu: "${CPUREQ}"
                memory: "${MEMREQ}"
                nvidia.com/gpu: ${GPUREQ}
              limits:
                cpu: "${CPULIM}"
                memory: "${MEMLIM}"
                nvidia.com/gpu: ${GPULIM}
            command:
              - ${COMMAND}
            args:
              - "${ARG1}"
              - "${ARG2}"
              - "${ARG3}"
              - "${ARG4}"
              - "${ARG5}"
              - "${ARG6}"
              - "${ARG7}"
              - "${ARG8}"
              - "${ARG9}"
              - "${ARG10}"
              - "${ARG11}"
              - "${ARG12}"
              - "${ARG13}"
            imagePullPolicy: Always
            volumeMounts:
              - mountPath: /nfs/
                name: nfs-access
        volumes:
          - name: nfs-access
            persistentVolumeClaim:
              claimName: 2587054avol1claim
            restartPolicy: Never
# after the object section, you need to list the parameters
# each one must have a name, and optionally a description
# and a default value
parameters:
  - name: JOBNAME
    description: "name of the job"
  - name: GPUTYPE
    value: "gpu2080ti"
    description: "set to either gpu2080ti or gputitan"
  - name: CONTAINERNAME
    description: "container name"
  - name: IMAGE
    description: "image to be used"
  - name: CPUREQ
    value: "2000m"
  - name: MEMREQ
    value: "32Gi"
  - name: GPUREQ
    value: "1"
  - name: CPULIM
    value: "4000m"
  - name: MEMLIM
    value: "64Gi"
  - name: GPULIM
    value: "1"
  - name: COMMAND
    description: "container command"
    value: "python3"
  - name: ARG1
    description: "1st arg for container command"
  - name: ARG2
    description: "2nd arg for container command"
  - name: ARG3
    description: "3rd arg for container command"
  - name: ARG4
    description: "4th arg for container command"
  - name: ARG5
    description: "5th arg for container command"
  - name: ARG6
    description: "6th arg for container command"
  - name: ARG7
    description: "7th arg for container command"
  - name: ARG8
    description: "8th arg for container command"
  - name: ARG9
    description: "9th arg for container command"
  - name: ARG10
    description: "10th arg for container command"
  - name: ARG11
    description: "11th arg for container command"
  - name: ARG12
    description: "12th arg for container command"  
  - name: ARG13
    description: "13th arg for container command"

